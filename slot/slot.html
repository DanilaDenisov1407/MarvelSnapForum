<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üé∞ –°–ª–æ—Ç –ú–∞—à–∏–Ω–∞</title>
  <style>
    :root { --reel-w: 140px; --reel-h: 140px; }
    body{
      background:#111;
      color:#fff;
      font-family: Arial, Helvetica, sans-serif;
      text-align:center;
      padding:30px;
    }
    h1{ margin:4px 0 16px; }
    .machine{ display:flex; justify-content:center; gap:18px; margin-top:10px; }
    .reel{
      width:var(--reel-w);
      height:var(--reel-h);
      border:3px solid #fff;
      border-radius:12px;
      background:#222;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow:0 4px 12px rgba(0,0,0,.6);
    }
    .reel img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      user-select:none;
      pointer-events:none;
    }
    #spin{
      margin-top:20px;
      padding:10px 18px;
      font-size:16px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      background:#fff;
      color:#000;
    }
    #spin:disabled{ opacity:.5; cursor:not-allowed; }
    #result{ margin-top:18px; font-size:18px; min-height:1.2em; }
    /* –º–∞–ª–µ–Ω—å–∫–∞—è –∞–¥–∞–ø—Ç–∏–≤–∫–∞ */
    @media (max-width:520px){
      :root{ --reel-w:110px; --reel-h:110px; }
    }
  </style>
</head>
<body>
  <h1>üé∞ –°–ª–æ—Ç –ú–∞—à–∏–Ω–∞</h1>

  <div class="machine">
    <div class="reel"><img id="img0" src="" alt=""></div>
    <div class="reel"><img id="img1" src="" alt=""></div>
    <div class="reel"><img id="img2" src="" alt=""></div>
  </div>

  <button id="spin">–ö—Ä—É—Ç–∏—Ç—å!</button>
  <div id="result"></div>

  <script>
    /***********************************************
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∏
     ***********************************************/
    const JSON_PATH = "./Cards.json";      // —Ñ–∞–π–ª —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML
    const TICK_MS = 80;                    // —á–∞—Å—Ç–æ—Ç–∞ —Å–º–µ–Ω—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–∏ –∫—Ä—É—á–µ–Ω–∏–∏ (–º—Å)
    const DURATION_BASE = 1200;            // —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º—Å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–µ—Ä–≤—ã–π –±–∞—Ä–∞–±–∞–Ω
    const BETWEEN = 900;                   // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ä–∞–±–∞–Ω–∞–º–∏ (–º—Å)
    const FINAL_CHECK_DELAY = 200;         // –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å—Å—è

    /***********************************************
     * –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
     ***********************************************/
    let images = [];                       // –º–∞—Å—Å–∏–≤ URL –∫–∞—Ä—Ç–∏–Ω–æ–∫ (—Å—Ç—Ä–æ–∫–∏)
    const imgEls = [
      document.getElementById("img0"),
      document.getElementById("img1"),
      document.getElementById("img2")
    ];
    const spinBtn = document.getElementById("spin");
    const resultEl = document.getElementById("result");

    /***********************************************
     * –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è Cards.json
     * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:
     *  - ["https://...","https://..."]
     *  - [{ "image": "...", "name":"..." }, {"img":"...",...}]
     ***********************************************/
    fetch(JSON_PATH)
      .then(r => r.json())
      .then(data => {
        if (!Array.isArray(data)) throw new Error("Cards.json –Ω–µ –º–∞—Å—Å–∏–≤");
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫-URL
        images = data.map(item => {
          if (typeof item === "string") return item;
          if (typeof item === "object" && item !== null) {
            return item.url || item.image || item.img || item.src || "";
          }
          return "";
        }).filter(Boolean);
        if (images.length === 0) {
          resultEl.textContent = "‚ö†Ô∏è Cards.json –ø—É—Å—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞";
          spinBtn.disabled = true;
        } else {
          // –ü–æ–∫–∞–∂–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ (—á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –ø—É—Å—Ç–æ–≤–∞–ª)
          imgEls.forEach(el => el.src = images[Math.floor(Math.random()*images.length)]);
        }
      })
      .catch(err => {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Cards.json:", err);
        resultEl.textContent = "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Cards.json";
        spinBtn.disabled = true;
      });

    /***********************************************
     * –£—Ç–∏–ª–∏—Ç—ã
     ***********************************************/
    function randUrl(){ return images[Math.floor(Math.random()*images.length)]; }

    /***********************************************
     * –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–ø–∏–Ω–∞:
     * - –≤—Å–µ 3 –±–∞—Ä–∞–±–∞–Ω–∞ –Ω–∞—á–∏–Ω–∞—é—Ç —Å–º–µ–Ω—è—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (setInterval)
     * - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ö –ø–æ –æ—á–µ—Ä–µ–¥–∏ (clearInterval —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
     ***********************************************/
    spinBtn.addEventListener("click", () => {
      if (!images.length) {
        resultEl.textContent = "‚è≥ –°—Å—ã–ª–∫–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å...";
        return;
      }

      spinBtn.disabled = true;
      resultEl.textContent = "";

      // –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      const intervals = [null, null, null];
      const finals = [null, null, null];

      // 1) —Å—Ç–∞—Ä—Ç—É–µ–º —Å–º–µ–Ω—É –∫–∞—Ä—Ç–∏–Ω–æ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
      imgEls.forEach((el, i) => {
        intervals[i] = setInterval(() => {
          el.src = randUrl();
        }, TICK_MS);
      });

      // 2) –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ –æ—á–µ—Ä–µ–¥–∏
      imgEls.forEach((el, i) => {
        const stopAt = DURATION_BASE + i * BETWEEN; // ms –æ—Ç —Å–µ–π—á–∞—Å
        setTimeout(() => {
          // –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
          clearInterval(intervals[i]);

          // —Å—Ç–∞–≤–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É (—Å—Ä–∞–∑—É) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ—ë URL
          const final = randUrl();
          el.src = final;
          finals[i] = final;
        }, stopAt);
      });

      // 3) –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞—Ä–∞–±–∞–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
      const lastStop = DURATION_BASE + (imgEls.length - 1) * BETWEEN;
      setTimeout(() => {
        // –¥–∞—ë–º –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å –Ω–∞ –ø–æ–¥–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        setTimeout(() => {
          // –ï—Å–ª–∏ —É –Ω–∞—Å –Ω–µ—Ç —Ñ–∏–Ω–∞–ª–æ–≤ (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ) ‚Äî –±–µ—Ä—ë–º src
          const finalURLs = finals.map((f, idx) => f || imgEls[idx].src);
          const win = finalURLs[0] && finalURLs[0] === finalURLs[1] && finalURLs[1] === finalURLs[2];

          if (win) {
            resultEl.textContent = "üéâ –í—ã–∏–≥—Ä–∞–ª–∏!";
          } else {
            resultEl.textContent = "–ü—Ä–æ–µ–±–∞–ª–∏?";
          }
          spinBtn.disabled = false;
        }, FINAL_CHECK_DELAY);
      }, lastStop + 30);
    });
  </script>
</body>
</html>
