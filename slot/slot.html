<script>
  let images = []; // —Å—é–¥–∞ –∑–∞–≥—Ä—É–∑–∏–º –∏–∑ JSON
  const reels = document.querySelectorAll(".reel-inner");
  const resultEl = document.getElementById("result");

  // –ó–∞–≥—Ä—É–∂–∞–µ–º JSON —Å –∫–∞—Ä—Ç–∞–º–∏
  fetch("Cards.json")
    .then(response => response.json())
    .then(data => {
      images = data;
    })
    .catch(err => {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Cards.json:", err);
      resultEl.textContent = "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Å—ã–ª–∫–∏!";
    });

  function spin() {
    if (images.length === 0) {
      resultEl.textContent = "‚ö†Ô∏è –°—Å—ã–ª–∫–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å!";
      return;
    }

    resultEl.textContent = "–ö—Ä—É—á—É—Å—å...";
    reels.forEach((reel, index) => {
      reel.innerHTML = "";

      // —Å–æ–∑–¥–∞—ë–º –ª–µ–Ω—Ç—É
      for (let i = 0; i < 20; i++) {
        const img = document.createElement("img");
        img.src = images[Math.floor(Math.random() * images.length)];
        reel.appendChild(img);
      }

      const finalImg = images[Math.floor(Math.random() * images.length)];
      const img = document.createElement("img");
      img.src = finalImg;
      reel.appendChild(img);

      reel.style.transition = "none";
      reel.style.top = "0px";

      setTimeout(() => {
        const totalHeight = reel.scrollHeight - 120;
        reel.style.transition = `top ${1 + index * 0.5}s ease-out`;
        reel.style.top = `-${totalHeight}px`;
      }, 50);

      reel.dataset.result = finalImg;
    });

    setTimeout(() => {
      const results = Array.from(reels).map(r => r.dataset.result);
      if (results[0] === results[1] && results[1] === results[2]) {
        resultEl.textContent = "üéâ –ü–æ–±–µ–¥–∞! –í—Å–µ —Å–æ–≤–ø–∞–ª–∏!";
      } else {
        resultEl.textContent = "üò¢ –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!";
      }
    }, 3000);
  }
</script>
