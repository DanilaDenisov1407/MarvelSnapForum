<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üé∞ –°–ª–æ—Ç –ú–∞—à–∏–Ω–∞</title>
  <style>
    :root { --reel-size: 120px; }

    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }
    h1 { margin-bottom: 20px; }

    .slot {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }
    .reel {
      width: var(--reel-size);
      height: var(--reel-size);
      overflow: hidden;
      border: 2px solid #fff;
      border-radius: 10px;
      position: relative;
      background: #222;
    }
    .reel-strip {
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
    }
    .reel img {
      width: 100%;
      height: var(--reel-size);
      display: block;
      user-select: none;
      pointer-events: none;
    }

    #spinBtn {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    #spinBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      min-height: 1.2em;
    }
  </style>
</head>
<body>
  <h1>üé∞ –°–ª–æ—Ç –ú–∞—à–∏–Ω–∞</h1>

  <div class="slot">
    <div class="reel"><div class="reel-strip"></div></div>
    <div class="reel"><div class="reel-strip"></div></div>
    <div class="reel"><div class="reel-strip"></div></div>
  </div>

  <button id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å!</button>
  <div id="result"></div>

  <script>
    const REEL_VIEW = 120;                 // –≤–∏–¥–∏–º–∞—è –≤—ã—Å–æ—Ç–∞ (px)
    const FILL_COUNT = 6;                  // —Å–∫–æ–ª—å–∫–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–∞—Ä—Ç –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π
    const BASE_DELAY = 200;                // –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º (–º—Å)
    const BETWEEN_DELAY = 900;             // –ø–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ä–∞–±–∞–Ω–∞–º–∏ (–º—Å)
    const SPIN_DURATION = 900;             // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –±–∞—Ä–∞–±–∞–Ω–∞ (–º—Å)

    let images = [];                       // —Å—é–¥–∞ –∑–∞–≥—Ä—É–∑–∏–º URL –∫–∞—Ä—Ç–∏–Ω–æ–∫

    // –ó–∞–≥—Ä—É–∂–∞–µ–º JSON (–ª–µ–∂–∏—Ç —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML –≤ –ø–∞–ø–∫–µ slot)
    fetch("./Cards.json")
      .then(r => r.json())
      .then(data => {
        // –æ–∂–∏–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
        images = (Array.isArray(data) ? data : []).filter(Boolean);
        if (images.length === 0) {
          document.getElementById("result").textContent = "‚ö†Ô∏è Cards.json –ø—É—Å—Ç–æ–π.";
        }
      })
      .catch(err => {
        console.error(err);
        document.getElementById("result").textContent = "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Cards.json.";
      });

    // —É—Ç–∏–ª–∏—Ç–∞: —Å–ª—É—á–∞–π–Ω—ã–π URL
    function randImg() {
      return images[Math.floor(Math.random() * images.length)];
    }

    // –æ–¥–Ω–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    function spinOnce() {
      const strips = document.querySelectorAll(".reel-strip");
      const spinBtn = document.getElementById("spinBtn");
      const resultEl = document.getElementById("result");

      if (images.length === 0) {
        resultEl.textContent = "‚è≥ –°—Å—ã–ª–∫–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å‚Ä¶";
        return;
      }

      spinBtn.disabled = true;
      resultEl.textContent = "";

      const finals = [];

      strips.forEach((strip, i) => {
        // –°–æ–±–∏—Ä–∞–µ–º –ª–µ–Ω—Ç—É
        strip.innerHTML = "";
        for (let k = 0; k < FILL_COUNT; k++) {
          const img = document.createElement("img");
          img.src = randImg();
          strip.appendChild(img);
        }
        const finalUrl = randImg();           // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
        finals.push(finalUrl);
        const finalImg = document.createElement("img");
        finalImg.src = finalUrl;
        strip.appendChild(finalImg);

        // –°—Ç–∞–≤–∏–º –ª–µ–Ω—Ç—É "–≤—ã—à–µ" –æ–∫–Ω–∞ –∏ –µ–¥–µ–º –≤–Ω–∏–∑ –∫ –Ω—É–ª—é
        const totalHeight = strip.scrollHeight - REEL_VIEW; // —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å
        strip.style.transition = "none";
        strip.style.top = `-${totalHeight}px`;

        // –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–æ—á–µ—Ä—ë–¥–Ω–æ
        setTimeout(() => {
          strip.style.transition = `top ${SPIN_DURATION}ms cubic-bezier(0.22,1,0.36,1)`;
          strip.style.top = "0px";
        }, BASE_DELAY + i * BETWEEN_DELAY);

        // —Å–æ—Ö—Ä–∞–Ω–∏–º —Ñ–∏–Ω–∞–ª –≤ data-–∞—Ç—Ä–∏–±—É—Ç (–Ω–∞ —Å–ª—É—á–∞–π –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
        strip.dataset.result = finalUrl;
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
      const lastStopAt = BASE_DELAY + (strips.length - 1) * BETWEEN_DELAY + SPIN_DURATION + 50;
      setTimeout(() => {
        const r = Array.from(strips).map(s => s.dataset.result);
        const win = r[0] && r[0] === r[1] && r[1] === r[2];
        resultEl.textContent = win ? "üéâ –ü–æ–±–µ–¥–∞! –í—Å–µ —Å–æ–≤–ø–∞–ª–∏!" : "üò• –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!";
        spinBtn.disabled = false;
      }, lastStopAt);
    }

    document.getElementById("spinBtn").addEventListener("click", spinOnce);
  </script>
</body>
</html>
